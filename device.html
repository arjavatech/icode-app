<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Device</title>
        <!-- Bootstrap link  -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
            <!-- Nav bar -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
    integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
    crossorigin="anonymous"></script>
    <link rel="stylesheet" href="employee_list.css">
</head>

<body>
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark bg-green">
            <div class="container">
                <!-- <a class="navbar-brand" href="#">Navbar</a> -->
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item me-4">
                            <a class="nav-link rounded-pill-active px-4" href="device.html">Device</a>
                        </li>
                        <li class="nav-item me-4">
                            <a class="nav-link" href="employee_list.html">Employee Management</a>
                        </li>
                        <li class="nav-item me-4">
                            <a class="nav-link" href="report_setting.html">Report</a>
                        </li>
                        <li class="nav-item me-4">
                            <a class="nav-link" href="profile.html">Profile</a>
                        </li>
                        <li class="nav-item me-4">
                            <a class="nav-link" href="contact.html">Contact Us</a>
                        </li>

                    </ul>
                    <div>
                        <a href="#" class="btn btn-outline-light" id="logout">Logout</a>
                    </div>

                </div>
            </div>
        </nav>
    </header>
    <div class="container mt-5">
        <div class="add_form_popup">
            <!-- Add Employee -->
            <button type="button" onclick="addData()" class="btn btn-green float-end" data-bs-toggle="modal"
                data-bs-target="#myModal">
                + Add
            </button>
        </div>
        <br><br>
        <div class="table-responsive">
            <table class="table table-bordered table-hover text-center">
                <thead>
                    <tr>
                        <th>Serial Number</th>
                        <th>access key</th>
                        <th>Device Id</th>
                        <th>Device name</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const tableBody = document.getElementById("tableBody");

        function maskString(input, visibleChars) {
            visibleChars = Math.min(visibleChars, input.length);
            const starsCount = input.length - visibleChars;
            const stars = '*'.repeat(starsCount);
            const visiblePart = input.slice(-visibleChars);
            return stars + visiblePart;
        }

        function addData() {
            const newRow = document.createElement('tr');
            const serialNumber = tableBody.rows.length + 1; // Get the current number of rows and add 1 for the new serial number
            newRow.innerHTML = `
            <td>${serialNumber}</td>
            <td class="AccessKey accesskey"></td>
            <td class="DId"></td>
            <td class="DName"></td>
            <td class="Action">
                <button class="btn icon-button btn-outline-green" onClick="delButton(this)">Delete</button>
                <button class="btn icon-button btn-outline-green" onClick="copyAccessKey(this)">Copy Key</button>
            </td>
    `;
            tableBody.appendChild(newRow);
            let accesskeyval = Math.random().toString(36).substring(2, 12); // Generate a random 10-character access key
            let accessKeyTag = newRow.querySelector(".accesskey");
            accessKeyTag.setAttribute("data-key", accesskeyval); // Store the real key value in a data attribute
            accessKeyTag.innerHTML = maskString(accesskeyval, 4);
        }

        function delButton(button) {
            const row = button.closest('tr'); // Get the closest <tr> element
            tableBody.removeChild(row); // Remove the row from the table
            updateSerialNumbers(); // Update serial numbers after deletion
        }

        function copyAccessKey(button) {
            const row = button.closest('tr'); // Get the closest <tr> element
            const accessKeyTag = row.querySelector(".accesskey");
            const accessKeyValue = accessKeyTag.getAttribute("data-key"); // Retrieve the real key value
            navigator.clipboard.writeText(accessKeyValue).then(() => {
                alert("Access key copied to clipboard!");
            }).catch(err => {
                console.error('Failed to copy: ', err);
            });
        }

        function updateSerialNumbers() {
            const rows = tableBody.rows;
            for (let i = 0; i < rows.length; i++) {
                rows[i].cells[0].innerText = i + 1; // Update the serial number cell for each row
            }
        }
    </script>
</body>

</html>
